---
import BaseLayout from '../layouts/BaseLayout.astro'
import CategoryCard from '../components/CategoryCard.vue'
import CharacterCard from '../components/CharacterCard.jsx'

export async function createCollection() {
  const response = await fetch('https://beta.pokeapi.co/graphql/v1beta', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      query: `
        query samplePokeAPIquery {
          species: pokemon_v2_pokemonspecies {
            id
            name
            details: pokemon_v2_pokemons {
              height
              weight
              moves: pokemon_v2_pokemonmoves {
                details: pokemon_v2_move {
                  name
                }
              }
              stats: pokemon_v2_pokemonstats {
                value: base_stat
                details: pokemon_v2_stat {
                  name
                }
              }
            }
            color: pokemon_v2_pokemoncolor {
              name
            }
          }
        }
      `
    }),
  }).then(res => res.json())

  const pokemons = response.data.species.map(pokemon => ({
    ...pokemon,
    image: `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${pokemon.id}.png`
  }));

  return {
    route: '/pokemons/:name',
    paths() {
      return pokemons.map(pokemon => ({params: {name: pokemon.name}}))
    },
    async props({ params}) {
      return {
        pokemon: pokemons.find(pokemon => pokemon.name === params.name),
      }
    }
  }
}

const { pokemon } = Astro.props
---
<BaseLayout
  title="{`${pokemon.name} - Astro Pokedex`}"
  description="{`PokÃ©mon ${pokemon.name} - Astro Pokedex`}"
  prevHref="{`/colors/${pokemon.color.name}`}"
>
  <CategoryCard pill href={`/colors/${pokemon.color.name}`} title={pokemon.color.name} color={pokemon.color.name} />
  <CharacterCard pokemon={pokemon} />
</BaseLayout>